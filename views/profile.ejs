<!DOCTYPE html>
<html lang="en">

<head>
  <title>Top Dogs! - User Profile</title>

  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
  <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="/styles/layout.css" type="text/css" /> -->
  <link rel="stylesheet" href="/styles/styles.css" type="text/css" />

  <script type="text/javascript" src="/vendor/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="/scripts/app.js"></script>

  <!-- Font Awesome External JS-->
  <script src="https://kit.fontawesome.com/<%= iconsKey %>.js"></script>


  <style>

    main {
      padding-bottom: 5rem;
    }

    #error-message-name, #error-message-phone {
      display: none;
      color: #BB2705;
    }

    .avatar-wrapper, .name-wrapper, .phone-wrapper, .email-wrapper {
      margin-top: 3rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .avatar-wrapper {
      margin-top: 0;
    }

    .hide-name, .hide-phone {
      display: none;
    }
  </style>
</head>

<body>
  <% include ./partials/_header %>
  <main>
    <form method='POST' action='/profile'>
      <div class="avatar-wrapper">
        <img src="<%= user.picture_url %>" alt="">
      </div>

      <div class="email-wrapper">
        <p>Email: <%= user.email %></p>
      </div>

      <div class="name-wrapper">
        <p>Name: <span><%= user.name %></span></p>
        <button class="edit-name" type="submit">Edit</button>
        <div class="hide-name show-name">
          <button class="update-name" type="submit">Update</button>
          <input type='name' name='name' placeholder='Name'>
          <div id="error-message-name"></div>
        </div>
      </div>

      <div class="phone-wrapper">
        <p>Phone number: <span><%= user.phone_number %></span></p>
        <button class="edit-phone" type="submit">Edit</button>
        <div class="hide-phone show-phone">
          <button class="update-phone" type="submit">Update</button>
          <input type='phone' name='phone' placeholder='Phone Number'>
          <div id="error-message-phone"></div>
        </div>
      </div>
    </form>
  </main>
  <% include ./partials/_footer %>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
  integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
  integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script>
$( document ).ready(function() {

  console.log( "Profile ready!" );

  $("input[name='name']").val('');

  $("button.edit-name").click(function(event) {
    event.preventDefault();

    $("button.edit-name").addClass("hide-name");
    $(".show-name").removeClass("hide-name");
  })

  $("button.update-name").click(function(event) {
    event.preventDefault();

    let fieldName = $('form').find("input[name='name']").val();

    let $error = $('<p>');
    $("#error-message-name").html($error);

    if (!fieldName) {
      $error.text("To update, please fill the empty fields.");
      $("#error-message-name").slideDown().addClass('show_error_msg');
    } else if (fieldName.length >= 25) {
      $error.text("Maximum number of characters reached.");
      $("#error-message-name").slideDown().addClass('show_error_msg');
    } else if (fieldName.indexOf(" ") !== -1) {
      $error.text("Remove spaces.");
      $("#error-message-name").slideDown().addClass('show_error_msg');
    } else {

      $.ajax({
        type: "POST",
        url: "/profile",
        data: {
          name: fieldName
        },
        success: (data) => {console.log("Retrieved new name!", data)}
        // ,
        // dataType: dataType
      });

      $(".show-name").addClass("hide-name");
      $("button.edit-name").removeClass("hide-name");

      $(".name-wrapper span").text(fieldName);
      $("input[name='name']").val('');
    }
  })

  $("button.edit-phone").click(function(event) {
    event.preventDefault();

    $("button.edit-phone").addClass("hide-phone");
    $(".show-phone").removeClass("hide-phone");
  })

  $("button.update-phone").click(function(event) {
    event.preventDefault();

    let fieldPhone = $('form').find("input[name='phone']").val();
    let $error = $('<p>');
    $("#error-message-phone").html($error);

    if (!fieldPhone) {
      $error.text("To update, please fill the empty fields.");
      $("#error-message-phone").slideDown().addClass('show_error_msg');
    } else if (fieldPhone.length >= 25) {
      $error.text("Maximum number of characters reached.");
      $("#error-message-phone").slideDown().addClass('show_error_msg');
    } else {

      $.ajax({
        type: "POST",
        url: "/profile",
        data: {
          phone: fieldPhone
        },
        success: (data) => {console.log("Retrieved new phone!", data)}
        // ,
        // dataType: dataType
      });

      $(".show-phone").addClass("hide-phone");
      $("button.edit-phone").removeClass("hide-phone");

      $(".phone-wrapper span").text(fieldPhone);
      $("input[name='phone']").val('');
    }
  })

});
</script>

</html>
